{% extends 'base.html' %}
{% load static %}

{% block page_title %}Selecionar Sistema{% endblock %}
{% block page_subtitle %}Escolha o sistema que deseja acessar{% endblock %}

{% block extra_css %}
<style>
    /* System Cards */
    .system-card {
        transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        text-decoration: none;
        display: block;
    }
    .system-card:hover:not(.disabled) {
        transform: translateY(-8px);
    }
    .system-card.disabled {
        opacity: 0.35;
        pointer-events: none;
        filter: grayscale(0.8);
        cursor: not-allowed;
        position: relative;
    }
    .system-card.disabled .card-inner {
        background: #f8f9fa;
        border-color: #d1d5db;
    }
    .system-card.disabled .card-inner::after {
        content: '';
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.05);
        border-radius: 16px;
        pointer-events: none;
    }
    .system-card .card-inner {
        background: #fff;
        border-radius: 16px;
        border: 2px solid #e2e8f0;
        padding: 1.75rem;
        position: relative;
        overflow: hidden;
        transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .system-card:hover:not(.disabled) .card-inner {
        box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.12);
    }
    .system-card .card-inner::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .system-card:hover:not(.disabled) .card-inner::before {
        opacity: 1;
    }

    /* Card hover colors - Blue for Diário, Purple for GestControll, Green for Mapa de Suprimentos */
    .system-card.diario:hover:not(.disabled) .card-inner { border-color: #3b82f6; }
    .system-card.diario .card-inner::before { background: #3b82f6; }
    .system-card.gestao:hover:not(.disabled) .card-inner { border-color: #a855f7; }
    .system-card.gestao .card-inner::before { background: #a855f7; }
    .system-card.mapa:hover:not(.disabled) .card-inner { border-color: #10b981; }
    .system-card.mapa .card-inner::before { background: #10b981; }

    /* System Icon */
    .system-icon {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .system-card:hover:not(.disabled) .system-icon {
        transform: scale(1.1) rotate(3deg);
    }
    .system-card.diario .system-icon { background: linear-gradient(135deg, #667eea, #764ba2); box-shadow: 0 4px 14px rgba(102, 126, 234, 0.35); }
    .system-card.gestao .system-icon { background: linear-gradient(135deg, #f093fb, #f5576c); box-shadow: 0 4px 14px rgba(245, 87, 108, 0.35); }
    .system-card.mapa .system-icon  { background: linear-gradient(135deg, #4facfe, #00f2fe); box-shadow: 0 4px 14px rgba(79, 172, 254, 0.35); }

    /* Badges */
    .access-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 3px 10px;
        border-radius: 9999px;
        font-size: 0.65rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    .access-badge.granted { background: #dcfce7; color: #166534; }
    .access-badge.denied  { background: #fef2f2; color: #991b1b; }

    /* Feature list */
    .feature-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    .feature-list li {
        display: flex;
        align-items: center;
        font-size: 0.8rem;
        color: #64748b;
        padding: 0.3rem 0;
    }
    .feature-list li i {
        width: 18px;
        text-align: center;
        margin-right: 0.5rem;
        font-size: 0.7rem;
        flex-shrink: 0;
    }
    .feature-list li i.fa-check-circle {
        color: inherit;
    }

    /* Arrow */
    .card-arrow {
        display: inline-flex;
        align-items: center;
        font-weight: 600;
        font-size: 0.85rem;
        gap: 0.375rem;
        transition: transform 0.2s ease;
    }
    .system-card:hover:not(.disabled) .card-arrow { transform: translateX(4px); }
    .system-card.diario .card-arrow { color: #3b82f6; }
    .system-card.gestao .card-arrow { color: #a855f7; }
    .system-card.mapa .card-arrow   { color: #10b981; }

    /* Acessibilidade: foco visível no teclado */
    .system-card:focus-visible,
    .admin-btn:focus-visible {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
    }
    .system-card:focus-visible { border-radius: 16px; }

    /* Welcome Banner */
    .welcome-banner {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: 16px;
        padding: 1.25rem 2rem;
        margin-bottom: 1.25rem;
        border: 1px solid #e2e8f0;
    }

    /* Admin Button */
    .admin-btn {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    .admin-btn:hover {
        background: linear-gradient(135deg, #334155 0%, #1e293b 100%);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        transform: translateY(-1px);
    }
    .admin-btn i {
        font-size: 1rem;
    }

    /* Tooltip */
    [data-tooltip] {
        position: relative;
    }
    [data-tooltip]:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        padding: 0.5rem 0.75rem;
        background: #1e293b;
        color: #fff;
        font-size: 0.75rem;
        border-radius: 6px;
        white-space: nowrap;
        margin-bottom: 0.5rem;
        z-index: 1000;
        pointer-events: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    [data-tooltip]:hover::before {
        content: '';
        position: absolute;
        bottom: calc(100% - 4px);
        left: 50%;
        transform: translateX(-50%);
        border: 4px solid transparent;
        border-top-color: #1e293b;
        z-index: 1000;
        pointer-events: none;
    }

    /* Stagger animation */
    .system-card:nth-child(1) { animation: cardUp 0.5s 0.05s both; }
    .system-card:nth-child(2) { animation: cardUp 0.5s 0.15s both; }
    .system-card:nth-child(3) { animation: cardUp 0.5s 0.25s both; }
    @keyframes cardUp {
        from { opacity: 0; transform: translateY(24px); }
        to   { opacity: 1; transform: translateY(0); }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
        .system-card,
        .system-card .card-inner,
        .system-card .system-icon,
        .system-card .card-arrow,
        .admin-btn {
            transition: none;
            animation: none;
        }
        .system-card:hover:not(.disabled) {
            transform: none;
        }
        .system-card:hover:not(.disabled) .system-icon {
            transform: none;
        }
        .system-card:hover:not(.disabled) .card-arrow {
            transform: none;
        }
        .admin-btn:hover {
            transform: none;
        }
    }

    @media (max-width: 768px) {
        .welcome-banner { padding: 1rem 1.25rem; }
    }

    /* Card de Suporte */
    .support-card {
        display: flex;
        align-items: center;
        gap: 1.25rem;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border: 1px solid #e2e8f0;
        border-radius: 16px;
        padding: 1.25rem 1.5rem;
        margin-top: 2rem;
        text-decoration: none;
        color: inherit;
        transition: all 0.3s ease;
    }
    .support-card:hover {
        border-color: #64748b;
        box-shadow: 0 8px 24px -8px rgba(0, 0, 0, 0.1);
    }
    .support-card:focus-visible {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
    }
    .support-card-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        background: linear-gradient(135deg, #475569 0%, #334155 100%);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        flex-shrink: 0;
    }
    .support-card-content { flex: 1; min-width: 0; }
    .support-card-title { font-size: 1rem; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem; }
    .support-card-text { font-size: 0.875rem; color: #64748b; margin-bottom: 0; }
    .support-card-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        color: #475569;
        flex-shrink: 0;
    }
    .support-card:hover .support-card-link { color: #0f172a; }
    @media (prefers-reduced-motion: reduce) {
        .support-card { transition: none; }
    }
    @media (max-width: 640px) {
        .support-card { flex-direction: column; text-align: center; }
        .support-card-link { align-self: center; }
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto fade-in">
    <!-- Welcome Banner -->
    <div class="welcome-banner">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div>
                <h2 class="text-2xl font-bold text-slate-900 mb-1">
                    Olá, {{ user.get_full_name|default:user.username|title }}
                </h2>
                <p class="text-slate-500 text-sm">Selecione o sistema que deseja acessar.</p>
            </div>
        </div>
    </div>

    {% if not has_diario and not has_gestao and not has_mapa and not has_central %}
    <div class="rounded-xl border-2 border-amber-200 bg-amber-50 p-4 mb-6" role="alert">
        <p class="text-amber-800 font-medium">Você não tem permissão para acessar nenhum sistema.</p>
        <p class="text-amber-700 text-sm mt-1">Contate o administrador para que seus acessos sejam configurados (grupos e obras).</p>
    </div>
    {% endif %}

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {% if has_central %}
        <!-- Painel do sistema: hub único para admin (obras, usuários, manutenção, ajuda, dashboard) -->
        <a href="{% url 'accounts:admin_central' %}" class="system-card central {% if not has_central %}disabled{% endif %}" aria-label="Painel do sistema" style="order: 0;">
            <div class="card-inner">
                <div class="flex items-start justify-between mb-3">
                    <div class="system-icon" style="background: linear-gradient(135deg, #0f172a 0%, #334155 100%);"><i class="fas fa-cog"></i></div>
                    <span class="access-badge granted"><i class="fas fa-check"></i> Admin</span>
                </div>
                <h3 class="text-lg font-bold text-slate-900 mt-2 mb-1">Painel do sistema</h3>
                <p class="text-sm text-slate-500 mb-4">Tudo em um lugar: obras, usuários, ajuda e dados</p>
                <div class="pt-3 border-t border-slate-100">
                    <ul class="feature-list">
                        <li><i class="fas fa-check-circle text-slate-500"></i>Obras e usuários</li>
                        <li><i class="fas fa-check-circle text-slate-500"></i>Manutenção e ajuda</li>
                        <li><i class="fas fa-check-circle text-slate-500"></i>Dashboard e estatísticas</li>
                        <li><i class="fas fa-check-circle text-slate-500"></i>Mapa de Suprimentos (obras)</li>
                    </ul>
                </div>
                <div class="mt-4 text-right">
                    <span class="card-arrow" style="color: #475569;">Acessar <i class="fas fa-arrow-right" style="font-size:0.7rem"></i></span>
                </div>
            </div>
        </a>
        {% endif %}
        <!-- Diário de Obra -->
        <a href="{% url 'select-project' %}" class="system-card diario {% if not has_diario %}disabled{% endif %}" aria-label="Acessar Diário de Obra" {% if not has_diario %}data-tooltip="Sem acesso"{% endif %}>
            <div class="card-inner">
                <div class="flex items-start justify-between mb-3">
                    <div class="system-icon"><i class="fas fa-book"></i></div>
                    {% if has_diario %}
                    <span class="access-badge granted"><i class="fas fa-check"></i> Acesso</span>
                    {% else %}
                    <span class="access-badge denied"><i class="fas fa-lock"></i> Sem acesso</span>
                    {% endif %}
                </div>
                <h3 class="text-lg font-bold text-slate-900 mt-2 mb-1">Diário de Obra</h3>
                <p class="text-sm text-slate-500 mb-4">Registro e gestão de relatórios diários</p>
                <div class="pt-3 border-t border-slate-100">
                    <ul class="feature-list">
                        <li><i class="fas fa-check-circle text-blue-500"></i>Registro de atividades diárias</li>
                        <li><i class="fas fa-check-circle text-blue-500"></i>Controle de mão de obra</li>
                        <li><i class="fas fa-check-circle text-blue-500"></i>Workflow de aprovação</li>
                        <li><i class="fas fa-check-circle text-blue-500"></i>Relatórios PDF</li>
                    </ul>
                </div>
                <div class="mt-4 text-right">
                    <span class="card-arrow">Acessar <i class="fas fa-arrow-right" style="font-size:0.7rem"></i></span>
                </div>
            </div>
        </a>

        <!-- GestControll -->
        <a href="{% url 'gestao:home' %}" class="system-card gestao {% if not has_gestao %}disabled{% endif %}" aria-label="Acessar GestControll" {% if not has_gestao %}data-tooltip="Sem acesso"{% endif %}>
            <div class="card-inner">
                <div class="flex items-start justify-between mb-3">
                    <div class="system-icon"><i class="fas fa-clipboard-check"></i></div>
                    {% if has_gestao %}
                    <span class="access-badge granted"><i class="fas fa-check"></i> Acesso</span>
                    {% else %}
                    <span class="access-badge denied"><i class="fas fa-lock"></i> Sem acesso</span>
                    {% endif %}
                </div>
                <h3 class="text-lg font-bold text-slate-900 mt-2 mb-1">GestControll</h3>
                <p class="text-sm text-slate-500 mb-4">Aprovação e controle de pedidos</p>
                <div class="pt-3 border-t border-slate-100">
                    <ul class="feature-list">
                        <li><i class="fas fa-check-circle text-purple-500"></i>Criação e gestão de pedidos</li>
                        <li><i class="fas fa-check-circle text-purple-500"></i>Fluxo aprovação/rejeição</li>
                        <li><i class="fas fa-check-circle text-purple-500"></i>Gestão de empresas</li>
                        <li><i class="fas fa-check-circle text-purple-500"></i>Notificações e e-mails</li>
                    </ul>
                </div>
                <div class="mt-4 text-right">
                    <span class="card-arrow">Acessar <i class="fas fa-arrow-right" style="font-size:0.7rem"></i></span>
                </div>
            </div>
        </a>

        <!-- Mapa de Suprimentos -->
        <a href="{% url 'mapa_obras:home' %}" class="system-card mapa {% if not has_mapa %}disabled{% endif %}" aria-label="Acessar Mapa de Suprimentos" {% if not has_mapa %}data-tooltip="Sem acesso"{% endif %}>
            <div class="card-inner">
                <div class="flex items-start justify-between mb-3">
                    <div class="system-icon"><i class="fas fa-map-marked-alt"></i></div>
                    {% if has_mapa %}
                    <span class="access-badge granted"><i class="fas fa-check"></i> Acesso</span>
                    {% else %}
                    <span class="access-badge denied"><i class="fas fa-lock"></i> Sem acesso</span>
                    {% endif %}
                </div>
                <h3 class="text-lg font-bold text-slate-900 mt-2 mb-1">Mapa de Suprimentos</h3>
                <p class="text-sm text-slate-500 mb-4">Controle de suprimentos e engenharia</p>
                <div class="pt-3 border-t border-slate-100">
                    <ul class="feature-list">
                        <li><i class="fas fa-check-circle text-emerald-500"></i>Mapa de suprimentos por obra</li>
                        <li><i class="fas fa-check-circle text-emerald-500"></i>Recebimentos e alocações</li>
                        <li><i class="fas fa-check-circle text-emerald-500"></i>Importação Sienge</li>
                        <li><i class="fas fa-check-circle text-emerald-500"></i>Dashboard de engenharia</li>
                    </ul>
                </div>
                <div class="mt-4 text-right">
                    <span class="card-arrow">Acessar <i class="fas fa-arrow-right" style="font-size:0.7rem"></i></span>
                </div>
            </div>
        </a>
    </div>

    <!-- Card de Suporte -->
    <a href="mailto:suporte@lplan.com.br?subject=LPLAN%20-%20Suporte%20ou%20d%C3%BAvida" class="support-card" aria-label="Entrar em contato com o suporte">
        <div class="support-card-icon"><i class="fas fa-headset"></i></div>
        <div class="support-card-content">
            <div class="support-card-title">Suporte</div>
            <p class="support-card-text">Em caso de dúvida ou erro, envie mensagem para <strong>suporte@lplan.com.br</strong>. Nossa equipe responde o mais rápido possível.</p>
        </div>
        <span class="support-card-link">Fale conosco <i class="fas fa-envelope" style="font-size:0.75rem"></i></span>
    </a>
</div>
{% endblock %}
